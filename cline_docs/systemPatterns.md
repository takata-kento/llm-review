# システムパターン

## アーキテクチャ

このプロジェクトは、以下のコンポーネントで構成されています：

1. **GitHub Actionsワークフロー**
   - 再利用可能なワークフローとして定義
   - 他のリポジトリから呼び出し可能
   - 入力パラメータを受け取り、処理を実行

2. **GitHub API連携**
   - Octokitを使用してGitHub APIと通信
   - プルリクエスト情報の取得
   - コメントの投稿

3. **LLM連携**
   - LangChain.jsを使用してClaude 3.7 Sonnetと通信
   - プロンプトテンプレートの管理
   - レスポンスの処理

## 主要な技術的決定

1. **TypeScriptの採用**
   - 型安全性の確保
   - コード補完とエラー検出の向上
   - メンテナンス性の向上

2. **LangChain.jsの使用**
   - LLMとの連携を簡素化
   - プロンプトテンプレートの管理
   - Anthropicインテグレーションの活用

3. **モジュラー設計**
   - 責務ごとにモジュールを分割
   - テスト容易性の向上
   - 拡張性の確保

4. **テスト駆動開発**
   - Jestを使用したテスト
   - モックを活用した外部依存の分離
   - 継続的な品質確保

## データフロー

1. ワークフロー呼び出し
2. 入力パラメータの検証
3. GitHub APIを使用してプルリクエスト情報を取得
4. リポジトリ構造と変更内容の分析
5. LLMにプロンプトを送信
6. レビューコメントの生成
7. GitHub APIを使用してコメントを投稿

## エラーハンドリング

- 入力パラメータのバリデーション
- API呼び出しのエラー処理
- LLMレスポンスの検証
- ログ出力による問題追跡

## セキュリティ考慮事項

- APIキーはGitHubシークレットとして管理
- 最小権限の原則に基づいたトークン設定
- 機密情報のログ出力防止
